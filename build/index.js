(()=>{"use strict";const e=window.wp.blocks,t=window.React,n=window.wp.i18n,o=window.wp.blockEditor,r=window.wp.coreData,s=window.wp.data,l=window.wp.element,a=window.wp.components,u=JSON.parse('{"UU":"wielgosz-info/wi-query-tax-filter"}');(0,e.registerBlockType)(u.UU,{edit:function({context:e,attributes:u,setAttributes:c}){const{query:{postType:i,taxQuery:m},queryId:p}=e,{taxonomy:w,number:y,buttonClassName:d}=u,f=(0,l.useRef)(),b=(0,s.useSelect)((e=>{const{getTaxonomies:t}=e(r.store);return t({type:i,per_page:-1})}),[i]),g=(0,l.useMemo)((()=>b?m?b.filter((e=>!Object.entries(m).some((([t,n])=>!(e.slug!==t||!n||!n.length))))):b:[]),[b,m]),x=(0,l.useMemo)((()=>g?g.map((e=>({label:e.name,value:e.slug}))):[]),[g]),q=(0,s.useSelect)((e=>{const{getEntityRecords:t}=e(r.store);return t("taxonomy",w,{per_page:y,orderby:"count",order:"desc"})}),[w,y]),E=(0,l.useMemo)((()=>[["core/buttons",{justifyContent:"flex-start",verticalAlignment:"center"},[["core/button",{text:(0,n.__)("All","wi-query-tax-filter"),url:`?query-${p}-page=1`,className:d}],...q?q.map((e=>["core/button",{text:e.name,url:`?query-${p}-page=1&query-${p}-qt-taxonomy=${w}&query-${p}-qt-term=${e.slug}`,className:d}])):[]]]]),[q,w,p,d]),k=(0,o.useInnerBlocksProps)((0,o.useBlockProps)(),{template:E,templateLock:"all"});return(0,l.useEffect)((()=>{!w&&g&&g.length>0&&c({taxonomy:g[0].slug})}),[w,g,c]),(0,l.useEffect)((()=>{if(f.current){const e=f.current.querySelector(".wp-block-button");if(e){const t=e.className.split(" ").find((e=>e.startsWith("is-style-")));t&&c({buttonClassName:t})}}}),[c]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(o.InspectorControls,null,(0,t.createElement)(a.PanelBody,null,(0,t.createElement)(a.SelectControl,{label:(0,n.__)("Taxonomy","wi-query-tax-filter"),value:w,options:x,onChange:e=>c({taxonomy:e})}),(0,t.createElement)(a.RangeControl,{label:(0,n.__)("Number of terms","wi-query-tax-filter"),value:y,onChange:e=>c({number:e}),min:1,max:20}))),(0,t.createElement)("div",{...k,ref:f}))},save:function(){const e=o.useBlockProps.save(),n=o.useInnerBlocksProps.save(e);return(0,t.createElement)("div",{...n})}})})();